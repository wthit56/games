<!DOCTYPE html>

<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title></title>
    </head>
    <body>
		<canvas id="source"></canvas>
		<canvas id="buffer"></canvas>
		<canvas id="dest"></canvas>
        <script type="text/javascript">
			var sourceCanvas = document.getElementById("source");
			sourceCanvas.width = 100; sourceCanvas.height = 100;

			var source = sourceCanvas.getContext("2d");
			source.fillStyle = "#FFFFFF"; source.fillRect(0, 0, 50, 100);
			source.fillStyle = "#000000"; source.fillRect(50, 0, 50, 100);
			document.body.appendChild(new Image()).src = sourceCanvas.toDataURL("iamge/png");

			var bufferCanvas = document.getElementById("buffer");
			bufferCanvas.width = bufferCanvas.height = 100;
			var buffer = bufferCanvas.getContext("2d");
			buffer.drawImage(sourceCanvas, 0, 0);

			var target = 1, steps = 10, step = (target - sourceCanvas.width) / steps;
			var _w = sourceCanvas.width, _h = sourceCanvas.height;
			var w = _w, h = _h;
			console.log("from " + _w + ", " + _h);

			do {
				//w = target + ((_w - target) / 2);
				//h = target + ((_h - target) / 2);

				w--;
				h--;

				console.log("step down to " + w + ", " + h);
				buffer.drawImage(bufferCanvas,
			        0, 0, _w, _h,
			        0, 0, w, h
			    );

				_w = w; _h = h;
			} while ((Math.round(w) !== target) || (Math.round(h) !== target));

			var destCanvas = document.getElementById("dest");
			destCanvas.width = destCanvas.height = 1;
			destCanvas.style.height = "100px";
			var dest = destCanvas.getContext("2d");
			dest.drawImage(bufferCanvas, 0, 0);
		</script>
    </body>
</html>
