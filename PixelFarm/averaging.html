<!DOCTYPE html>

<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title></title>
    </head>
    <body>
		<canvas id="source"></canvas>
		<canvas id="dest"></canvas>
        <script type="text/javascript">
			var sourceCanvas = document.getElementById("source");
			sourceCanvas.width = 100; sourceCanvas.height = 100;

			var source = sourceCanvas.getContext("2d");
			source.fillStyle = "#FFFFFF"; source.fillRect(0, 0, 50, 100);
			source.fillStyle = "#000000"; source.fillRect(50, 0, 50, 100);

			var sourceData = source.getImageData(-50, 0, 100, 100);


			var destCanvas = document.getElementById("dest");
			destCanvas.width = 100; destCanvas.height = 100;

			var dest = destCanvas.getContext("2d");

			var average = { r: 0, g: 0, b: 0, a: 0 };
			var i = 0, l = sourceData.data.length;
			console.time("averaging");
			{
				while (i < l) {
					average.r += sourceData.data[i++];
					average.g += sourceData.data[i++];
					average.b += sourceData.data[i++];
					average.a += sourceData.data[i++];
				}

				//console.log(average);

				average.r /= (l / 4);
				average.g /= (l / 4);
				average.b /= (l / 4);
				average.a /= (l / 4);

				//console.log(average);

			}
			console.timeEnd("averaging");

			dest.fillStyle = "rgba(" +
			    Math.round(average.r) + "," +
			    Math.round(average.g) + "," +
			    Math.round(average.b) + "," +
			    (average.a / 255) +
			")";
			dest.fillRect(0, 0, 100, 100);
		</script>
    </body>
</html>
