<!DOCTYPE html>

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>Pixel Farm</title>
		<style type="text/css">
  	body {
		  margin: 0; padding: 0;
  	}
  	canvas {
		  /*border: 2px solid #ccc;*/
		  margin: 10px;
  	}
		</style>
		<script src="on.js" type="text/javascript"></script>
		<script src="PixelFarm.js" type="text/javascript"></script>
	</head>
	<body>
        <img id="source" src="google2.jpg" /><br />
		<canvas id="buffer" width="1" height="1" style="width: 100px; height: 100px; background: black;"></canvas>
		<canvas id="destination" width="100" height="100"></canvas>
		<script type="text/javascript">
  	on(window, "load", function () {
  		var source = document.getElementById("source");
  		var buffer = document.getElementById("buffer"), bufferCtx = buffer.getContext("2d");
  		var dest = document.getElementById("destination"), destCtx = dest.getContext("2d");
  		dest.width = source.width; dest.height = source.height;
  		dest.style.height = "100px";

  		buffer.width = buffer.height = 100;
  		bufferCtx.strokeStyle = "white";
  		bufferCtx.moveTo(50.5, 0);
  		bufferCtx.lineTo(50.5, 100);
  		bufferCtx.stroke();
  		//bufferCtx.translate(0.4, 0.4);
  		//bufferCtx.drawImage(source, 0, 0);

  		on(source, "mousemove", function (e) {
  			bufferCtx.clearRect(0, 0, 1, 1);

  			bufferCtx.save();
  			var scale = Math.min(100 / source.width, 100 / source.height); document.title = (scale);
  			//bufferCtx.scale(scale, scale);

  			//bufferCtx.scale(1 / source.width, 1 / source.height);
  			scale = 2;
  			//bufferCtx.scale(scale, scale);
  			//bufferCtx.translate(-e.pageX, -e.pageY);
  			bufferCtx.drawImage(source, 0, 0);
  			bufferCtx.restore();

  			//bufferCtx.drawImage(source,
  			//  e.pageX - 50, e.pageY - 50, 100, 100,
  			//  0, 0, 1, 1
  			//);

  			destCtx.drawImage(source, 0, 0);
  			destCtx.drawImage(buffer,
  	            0, 0, 1, 1,
  	            e.pageX - 50, e.pageY - 50, 100, 100
  	        );
  		});
  	});
		</script>
	</body>
</html>
